<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="Sturgeon.Sexp.html">
<link rel="next" href="Sturgeon.Stui.html">
<link rel="Up" href="Sturgeon.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Sturgeon" rel="Chapter" href="Sturgeon.html">
<link title="Sturgeon_recipes_command" rel="Chapter" href="Sturgeon_recipes_command.html">
<link title="Sturgeon_recipes_server" rel="Chapter" href="Sturgeon_recipes_server.html">
<link title="Sturgeon_session" rel="Chapter" href="Sturgeon_session.html">
<link title="Sturgeon_sexp" rel="Chapter" href="Sturgeon_sexp.html">
<link title="Sturgeon_stui" rel="Chapter" href="Sturgeon_stui.html"><title>Sturgeon.Session</title>
</head>
<body>
<div class="navbar"><a class="pre" href="Sturgeon.Sexp.html" title="Sturgeon.Sexp">Previous</a>
&nbsp;<a class="up" href="Sturgeon.html" title="Sturgeon">Up</a>
&nbsp;<a class="post" href="Sturgeon.Stui.html" title="Sturgeon.Stui">Next</a>
</div>
<h1>Module <a href="type_Sturgeon.Session.html">Sturgeon.Session</a></h1>

<pre><span class="keyword">module</span> Session: <code class="type"><a href="Sturgeon_session.html">Sturgeon_session</a></code></pre><hr width="100%">
<br>
Session extends S-exp with abstract objects.
    One can now put function-like values inside s-expressions.
<p>

    When serializing, the library will take care of representing these values
    by handles that can be used from the remote side.<br>

<pre><code><span id="TYPEresult"><span class="keyword">type</span> <code class="type">'a</code> result</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTresult.Feed"><span class="constructor">Feed</span></span> <span class="keyword">of</span> <code class="type">'a</code></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" ><div class="info ">
Feed is the action to transmit a value to an abstract object.
      See <code class="code">dual</code> type below.
      A promise (<code class="code"><span class="constructor">Once</span></code>) can be fed only once, a stream (<code class="code"><span class="constructor">Sink</span></code>) can be fed
      an arbitrary number of times.<br>
</div>
</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTresult.Quit"><span class="constructor">Quit</span></span> <span class="keyword">of</span> <code class="type"><a href="Sturgeon_sexp.html#TYPEbasic">Sturgeon_sexp.basic</a></code></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" ><div class="info ">
Quit release an abstract object.
      If it is a promise (<code class="code"><span class="constructor">Once</span></code>), it will be canceled (waiter will receive an
      error), if it is a stream (<code class="code"><span class="constructor">Sink</span></code>) it will be closed.<br>
</div>
</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr></table>

<div class="info ">
The actions that can be sent to abstract objects.<br>
</div>


<pre><span id="TYPEneg"><span class="keyword">type</span> <code class="type">'a</code> neg</span> = <code class="type">'a <a href="Sturgeon_session.html#TYPEresult">result</a> -> unit</code> </pre>
<div class="info ">
Negation: consuming values.
    Normal values are <code class="code">positive</code>. When you have one of them you own an instance
    of some type.
    Negations are the opposite. When you have one of them all you can do is
    provide an instance of some type.
<p>

    Positive and negative values are the building blocks of more complex
    control flows.
    For instance, a function from <code class="code"><span class="keywordsign">'</span>a <span class="keywordsign">-&gt;</span> <span class="keywordsign">'</span>b</code> be encoded as <code class="code">(<span class="keywordsign">'</span>a * <span class="keywordsign">'</span>b neg) neg</code>:
    if you give a <code class="code"><span class="keywordsign">'</span>a</code>, you will own a <code class="code"><span class="keywordsign">'</span>b</code>.<br>
</div>


<pre><code><span id="TYPEdual"><span class="keyword">type</span> <code class="type"></code>dual</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTdual.Once"><span class="constructor">Once</span></span> <span class="keyword">of</span> <code class="type"><a href="Sturgeon_session.html#TYPEt">t</a> <a href="Sturgeon_session.html#TYPEneg">neg</a></code></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" ><div class="info ">
<code class="code"><span class="constructor">Once</span></code> is the constructor for linear negations:
                      they can consume only one value.<br>
</div>
</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTdual.Sink"><span class="constructor">Sink</span></span> <span class="keyword">of</span> <code class="type"><a href="Sturgeon_session.html#TYPEt">t</a> <a href="Sturgeon_session.html#TYPEneg">neg</a></code></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" ><div class="info ">
<code class="code"><span class="constructor">Sink</span></code> is the constructor for streams:
                      they can consume arbitrarily many values.<br>
</div>
</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr></table>



<pre><span id="TYPEt"><span class="keyword">type</span> <code class="type"></code>t</span> = <code class="type"><a href="Sturgeon_session.html#TYPEdual">dual</a> <a href="Sturgeon_sexp.html#TYPEsexp">Sturgeon_sexp.sexp</a></code> </pre>
<div class="info ">
Finally the type of sessions: it is the S-exp extended with dual values.<br>
</div>


<pre><span id="VALcancel_message"><span class="keyword">val</span> cancel_message</span> : <code class="type">'a <a href="Sturgeon_session.html#TYPEresult">result</a></code></pre><div class="info ">
The message to send to cancel a negation<br>
</div>

<pre><span id="VALfinalize_message"><span class="keyword">val</span> finalize_message</span> : <code class="type">'a <a href="Sturgeon_session.html#TYPEresult">result</a></code></pre><div class="info ">
The message send by the GC when a negation is collected
    (and will never be reachable again).<br>
</div>

<pre><span id="VALcancel"><span class="keyword">val</span> cancel</span> : <code class="type">?stderr:([> `Exceptions_during_cancellation of <a href="Sturgeon_session.html#TYPEt">t</a> * exn list ] -><br>                unit) -><br>       <a href="Sturgeon_session.html#TYPEt">t</a> -> unit</code></pre><div class="info ">
Cancel a session: traverse all sub-expressions to cancel negations.<br>
</div>

<pre><span id="TYPEerror"><span class="keyword">type</span> <code class="type">'a</code> error</span> = <code class="type">[ `Already_closed of <a href="Sturgeon_session.html#TYPEt">t</a> <a href="Sturgeon_session.html#TYPEresult">result</a><br>       | `Exceptions_during_cancellation of <a href="Sturgeon_session.html#TYPEt">t</a> * exn list<br>       | `Exceptions_during_shutdown of exn list<br>       | `Feed_unknown of <a href="Sturgeon_sexp.html#TYPEbasic">Sturgeon_sexp.basic</a><br>       | `Invalid_command of <a href="Sturgeon_sexp.html#TYPEbasic">Sturgeon_sexp.basic</a><br>       | `Query_after_eof of <a href="Sturgeon_session.html#TYPEt">t</a><br>       | `Quit_unknown of <a href="Sturgeon_sexp.html#TYPEbasic">Sturgeon_sexp.basic</a> ]</code> </pre>


<pre><span id="TYPEoutput"><span class="keyword">type</span> <code class="type"></code>output</span> = <code class="type"><a href="Sturgeon_sexp.html#TYPEbasic">Sturgeon_sexp.basic</a> -> unit</code> </pre>


<pre><span id="TYPEstatus"><span class="keyword">type</span> <code class="type"></code>status</span> </pre>


<pre><span id="VALconnect"><span class="keyword">val</span> connect</span> : <code class="type">?greetings:<a href="Sturgeon_session.html#TYPEt">t</a> -><br>       ?cogreetings:(<a href="Sturgeon_session.html#TYPEt">t</a> -> unit) -><br>       ?stderr:('a <a href="Sturgeon_session.html#TYPEerror">error</a> -> unit) -><br>       <a href="Sturgeon_session.html#TYPEoutput">output</a> -> <a href="Sturgeon_session.html#TYPEoutput">output</a> * <a href="Sturgeon_session.html#TYPEstatus">status</a></code></pre><div class="info ">
Basic creation of a session.
    <code class="code">greetings</code> and <code class="code">cogreetings</code> are respectively the first session sent and
    received.
    The whole purpose of connect is to convert high-level sessions to plain
    values back and forth, by allocating and managing concrete addresses.<br>
</div>

<pre><span id="VALclose"><span class="keyword">val</span> close</span> : <code class="type"><a href="Sturgeon_session.html#TYPEoutput">output</a> -> unit</code></pre>
<pre><span id="VALpending_sessions"><span class="keyword">val</span> pending_sessions</span> : <code class="type"><a href="Sturgeon_session.html#TYPEstatus">status</a> -> int</code></pre>
<pre><span id="VALis_closed"><span class="keyword">val</span> is_closed</span> : <code class="type"><a href="Sturgeon_session.html#TYPEstatus">status</a> -> bool</code></pre></body></html>